<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>scroll-pagination.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.1&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.5.1&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/ScrollPagination.html">ScrollPagination</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/scroll-pagination.html">scroll-pagination</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: scroll-pagination.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;*global YUI, window *&#x2F;
&#x2F;**
 * A widget that makes a page or a division can dynamically load data
 * by mouse scrolling without clicking any links.
 * It has various namings such as Continuous Scrolling, Infinite Scroll,
 * and the name we use, Scroll Pagination.
 *
 * @module scroll-pagination
 * @requires base
 *&#x2F;
YUI.add(&quot;scroll-pagination&quot;, function (Y) {

    var MODULE_ID           = &quot;Y.ScrollPagination&quot;,
        INDICATOR_CLASSNAME = &quot;yui3-scroll-pagination-indicator&quot;,
        LOADING_CLASSNAME   = &quot;yui3-scroll-pagination-loading&quot;,
        CLICK_CLASSNAME     = &quot;yui3-scroll-pagination-click&quot;,
        FINISH_CLASSNAME    = &quot;yui3-scroll-pagination-end&quot;,
        INDICATOR_SELECTOR  = &quot;.&quot; + INDICATOR_CLASSNAME;

    &#x2F;**
     * A widget that makes a page or division can dynamically load data
     * by scrolling mouse wheel without clicking any links.
     * The UI pattern has varied namings such as Continuous Scrolling,
     * Infinite Scroll, and Scroll Pagination.
     *
     *     _scroll = new Y.ScrollPagination({
     *         container: _node.one(&quot;.bd&quot;),
     *         foldDistance: 500,
     *         delay: 1000,
     *         data: {
     *             source: &quot;&#x2F;welcome&#x2F;q&#x2F;get_notification_list?format=html&quot;,
     *             schema: {
     *                 metaFields: {
     *                     last_id: &quot;last_id&quot;,
     *                     last_ts: &quot;last_ts&quot;,
     *                     html   : &quot;html&quot;
     *                 }
     *             },
     *             request: [
     *                 &quot;&amp;last_id=&quot; + _node.one(&quot;#last_id&quot;).get(&quot;value&quot;),
     *                 &quot;&amp;last_ts=&quot; + _node.one(&quot;#last_ts&quot;).get(&quot;value&quot;),
     *                 &quot;&amp;r=&quot; + parseInt(new Date().getTime(), 10)
     *             ].join(&quot;&quot;)
     *         }
     *     });
     *     _scroll.on(&quot;load&quot;, _loadHandler);
     *
     * @constructor
     * @class ScrollPagination
     * @param {Object} config attribute object
     *&#x2F;
    function ScrollPagination (config) {
        ScrollPagination.superclass.constructor.apply(this, arguments);
    }

    &#x2F;**
     * @property NAME
     *&#x2F;
    ScrollPagination.NAME = &quot;scroll-pagination&quot;;

    &#x2F;**
     * @property ATTRS
     *&#x2F;
    ScrollPagination.ATTRS = {
        &#x2F;**
         * An optional attribute.
         * Default we use body as container.
         * If this is being set, it will be the ancestor node to append UI.
         *
         * @attribute container
         *&#x2F;
        &quot;container&quot;: {
            value: null
        },
        &#x2F;**
         * Distance below the fold for which data starts to load.
         * Data doesn&#x27;t start to load until the indicator is at
         * most this distance away from (or above) the fold.
         *
         * @attribute foldDistance
         * @type {Number}
         * @default 100
         *&#x2F;
        &quot;foldDistance&quot;: {
            value: 100,
            validator: Y.Lang.isNumber
        },
        &#x2F;**
         * The indicator shows loading immediately when user
         * scrolls to the region. However, we delayed this time
         * sending to server to avoid the performance issue
         * when user scrolls faster than data loading.
         *
         * @attribute delay
         * @type {Number}
         * @default 500
         *&#x2F;
        &quot;delay&quot;: {
            value: 500,
            validator: Y.Lang.isNumber
        },
        &#x2F;**
         * The scrolling region.
         * You may use window as scrolling region,
         * but show control UI in another node. (container attribute helps.)
         *
         * @attribute node
         * @type {Y.Node|String|HTML Element}
         * @default window
         *&#x2F;
        &quot;node&quot;: {
            value: window,
            writeOnce: true
        },
        &#x2F;**
         * Set the autoLoad attribute to false and the UI will
         * shows &#x27;more&#x27; link. In our scenario we only want
         * user has scrolling loading for 5 times.
         * To achieve this, set this value during instance level.
         *
         * @attribute autoLoad
         * @type {Boolean}
         * @default true
         *&#x2F;
        &quot;autoLoad&quot;: {
            value: true,
            validator: Y.Lang.isBoolean,
            setter: function (value) {
                if (value) {
                    return value;
                }
                Y.log(&quot;The setter of autoLoad attribute is invoked.&quot;, &quot;info&quot;, MODULE_ID);
                var node = Y.one(INDICATOR_SELECTOR);
                node.setContent(&quot;&lt;a href=\&quot;javascript:void(0);\&quot; class=\&quot;more-link\&quot;&gt;Show more notifications&lt;&#x2F;a&gt;&quot;);
                node.addClass(CLICK_CLASSNAME);
                return value;
            }
        },
        &#x2F;**
         * Set this value if you want stop loading data from server.
         *
         * @attribute isEnd
         * @type {Boolean}
         * @default false
         *&#x2F;
        &quot;isEnd&quot;: {
            value: false,
            validator: Y.Lang.isBoolean,
            setter: function (value) {
                if (!value) {
                    return value;
                }
                Y.log(&quot;The setter of isEnd attribute is invoked.&quot;, &quot;info&quot;, MODULE_ID);
                var self = this,
                    node = Y.one(INDICATOR_SELECTOR);
                self._set(&quot;autoLoad&quot;, false);
                node.removeClass(CLICK_CLASSNAME);
                node.addClass(FINISH_CLASSNAME);
                node.setContent(self.NO_DATA_TEMPLATE);
                return value;
            }
        },
        &#x2F;**
         * A required attribute which helps this widget to set
         * Y.DataSource.IO instance for you to load data.
         * Currently this widget only support AJAX with JSON data.
         * Check YUI DataSource to get more information.
         *
         *     data: {
         *         source: &quot;ajax.php&quot;,
         *         schema: {
         *             metaFields: {
         *                 count: &quot;result.count&quot;,
         *                 last_id: &quot;result.last_id&quot;,
         *                 last_timestamp: &quot;result.last_timestamp&quot;,
         *                 html: &quot;result.html&quot;
         *             }
         *         },
         *         request: &quot;?page=1&amp;r=&quot; + parseInt(new Date().getTime(), 10)
         *     }
         *
         * @attribute data
         * @type {Object}
         *&#x2F;
        &quot;data&quot;: {
            value: null,
            setter: function (value) {
                var request = value.request || &quot;&quot;;
                if (!this._dataSource) {
                    this._dataSource = new Y.DataSource.IO({
                        source: value.source
                    }).plug(Y.Plugin.DataSourceJSONSchema, {schema: value.schema});
                }
                this._request = request;
                return value;
            },
            validator: function (value) {
                if (!Y.Lang.isObject(value)) {
                    return false;
                }
                if (
                    Y.Lang.isUndefined(value.schema) ||
                    Y.Lang.isUndefined(value.source)
                ) {
                    return false;
                }
                return true;
            }
        }
    };

    Y.extend(ScrollPagination, Y.Base, {
        &#x2F;**
         * @property LOADING_TEMPLATE
         * @public
         *&#x2F;
        LOADING_TEMPLATE : &quot;&lt;p&gt;Loading...&lt;&#x2F;p&gt;&quot;,
        &#x2F;**
         * @property NO_DATA_TEMPLATE
         * @public
         *&#x2F;
        NO_DATA_TEMPLATE  : &quot;&lt;p&gt;No more data&lt;&#x2F;p&gt;&quot;,
        &#x2F;**
         * @property MORE_LINK_TEMPLATE
         * @public
         *&#x2F;
        MORE_LINK_TEMPLATE: &quot;&lt;a href=\&quot;javascript:void(0);\&quot; class=\&quot;more-link\&quot;&gt;Show more notifications&lt;&#x2F;a&gt;&quot;,
        &#x2F;**
         * @property INDICATOR_TEMPLATE
         * @public
         *&#x2F;
        INDICATOR_TEMPLATE: [
            &quot;&lt;div class=\&quot;&quot; + INDICATOR_CLASSNAME + &quot;\&quot;&gt;&quot;,
                &quot;&lt;a href=\&quot;javascript:void(0);\&quot; class=\&quot;more-link\&quot;&gt;Show more notifications&lt;&#x2F;a&gt;&quot;,
            &quot;&lt;&#x2F;div&gt;&quot;
        ].join(&quot;&quot;),
        &#x2F;**
         * The Y.DataSource.IO instance runs inside.
         *
         * @property _dataSource
         * @private
         *&#x2F;
        _dataSource: null,
        _handlers: [],
        &#x2F;**
         * The flag to check whether it still processes loading.
         *
         * @property _isLock
         * @private
         *&#x2F;
        _isLock: false,
        &#x2F;**
         * Handles when user has page scrolling.
         * It decides whether or not to load data from server.
         *
         * @event _scrollHandler
         * @private
         *&#x2F;
        _scrollHandler: function () {
            if (this._isLock || !this.get(&quot;autoLoad&quot;)) {
                return;
            }
            Y.log(&quot;scrollHandler() is executed.&quot;, &quot;info&quot;, MODULE_ID);
            var self = this,
                node,
                posScroll,
                posLoad,
                needLoad;

            node = Y.one(INDICATOR_SELECTOR);
            if (self.get(&quot;node&quot;)._node === window) {
                posScroll = node.get(&quot;winHeight&quot;) + node.get(&quot;docScrollY&quot;);
            } else {
                posScroll = self.get(&quot;node&quot;).get(&quot;scrollHeight&quot;) + self.get(&quot;node&quot;).get(&quot;scrollTop&quot;);
            }
            posLoad  = node.get(&quot;region&quot;).bottom - self.get(&quot;foldDistance&quot;);
            needLoad = (posScroll &gt; posLoad);
            if (!needLoad) {
                return;
            }
            if (!self.get(&quot;data&quot;)) {
                Y.log(&quot;_scrollHandler() - Oops! You must define the &#x27;data&#x27; attribute.&quot;);
                return;
            }
            node.removeClass(CLICK_CLASSNAME);
            node.addClass(LOADING_CLASSNAME);
            node.setContent(self.LOADING_TEMPLATE);
            if (self.get(&quot;delay&quot;)) {
                Y.later(self.get(&quot;delay&quot;), self, self._makeRequest);
            } else {
                self._makeRequest();
            }
            self._isLock = true;

        },
        &#x2F;**
         * Make request to server.
         * It triggers load event when we make request successfully.
         *
         * @method _makeRequest
         * @private
         *&#x2F;
        _makeRequest: function () {
            Y.log(&quot;_makeRequest() is executed.&quot;, &quot;info&quot;, MODULE_ID);
            var self = this;
            self._dataSource.sendRequest({
                request: self._request,
                callback: {
                    success: function (o) {
                        self.fire(&quot;load&quot;, o.response);
                        self._isLock = false;
                        Y.one(INDICATOR_SELECTOR).removeClass(LOADING_CLASSNAME);
                        if (!self.get(&quot;autoLoad&quot;) &amp;&amp; !self.get(&quot;isEnd&quot;)) {
                            Y.one(INDICATOR_SELECTOR).setContent(self.MORE_LINK_TEMPLATE);
                            Y.one(INDICATOR_SELECTOR).addClass(CLICK_CLASSNAME);
                        }
                    },
                    failure: function (e) {
                        self.fire(&quot;fail&quot;, e.error);
                        Y.log(&quot;Error - &quot; + e.error.message, &quot;error&quot;, MODULE_ID);
                    }
                }
            });
        },
        destructor: function () {
            var self = this;
            Y.each(self._handlers, function (handler) {
                handler.detach();
            });
        },
        &#x2F;**
         * It will be invoked after user instanitate a instance.
         *
         * @method initializer
         * @public
         *&#x2F;
        initializer: function (config) {
            Y.log(&quot;initializer() is executed.&quot;, &quot;info&quot;, MODULE_ID);
            var self = this,
                container,
                node;

            node = config.node || window;
            container = config.container || null;

            if (config.data) {
                self.set(&quot;data&quot;, config.data);
            }

            &#x2F;&#x2F; Bind Events.
            if (node === window) {
                self._set(&quot;node&quot;, Y.one(node));
                self._handlers.push(Y.one(node).on(&quot;scroll&quot;, self._scrollHandler, self));
                self._handlers.push(Y.on(&quot;windowresize&quot;, self._scrollHandler, self));
                node = Y.one(&quot;body&quot;);
            } else {
                node = Y.one(node);
                if (!node) {
                    return;
                }
                self._set(&quot;node&quot;, Y.one(node));
                self._handlers.push(node.on(&quot;scroll&quot;, self._scrollHandler, self));
            }

            &#x2F;&#x2F; Render UI.
            container = container || node;
            if (!container.one(INDICATOR_SELECTOR)) {
                container.append(self.INDICATOR_TEMPLATE);
            }

            &#x2F;&#x2F; Manually load from server when you set autoLoad = false.
            self._handlers.push(node.one(INDICATOR_SELECTOR).delegate(&quot;click&quot;, function () {
                var self = this,
                    node;
                node = Y.one(INDICATOR_SELECTOR);
                node.removeClass(CLICK_CLASSNAME);
                node.addClass(LOADING_CLASSNAME);
                node.setContent(self.LOADING_TEMPLATE);
                if (self.get(&quot;delay&quot;)) {
                    Y.later(self.get(&quot;delay&quot;), self, self._makeRequest);
                } else {
                    self._makeRequest();
                }
                self._isLock = true;
            }, &quot;a.more-link&quot;, self));

            &#x2F;&#x2F; Initial checking.
            self._scrollHandler.call(self);

        }
    });

    &#x2F;&#x2F; Promote to YUI environment.
    Y.ScrollPagination = ScrollPagination;


}, &quot;0.0.1&quot;, {&quot;requires&quot;: [&quot;base&quot;, &quot;node-base&quot;, &quot;node-screen&quot;, &quot;event-resize&quot;, &quot;node-event-delegate&quot;, &quot;datasource-io&quot;, &quot;datasource-jsonschema&quot;]});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
